<!doctype html>
<html><head>
<meta http-equiv="content-type" content="text/html;charset=utf-8">
<title>CD2019</title> <link rel="stylesheet" type="text/css" href="./../static/cmsimply.css">
<script src="tipuesearch_content.js"></script>
<script src="./../static/jquery.js"></script>
<link rel="stylesheet" href="./../static/tipuesearch/css/tipuesearch.css">
<script src="./../static/tipuesearch/tipuesearch_set.js"></script>
<script src="./../static/tipuesearch/tipuesearch.min.js"></script>

<script type="text/javascript" src="./../static/syntaxhighlighter/shCore.js"></script>
<script type="text/javascript" src="./../static/syntaxhighlighter/shBrushJScript.js"></script>
<script type="text/javascript" src="./../static/syntaxhighlighter/shBrushJava.js"></script>
<script type="text/javascript" src="./../static/syntaxhighlighter/shBrushPython.js"></script>
<script type="text/javascript" src="./../static/syntaxhighlighter/shBrushSql.js"></script>
<script type="text/javascript" src="./../static/syntaxhighlighter/shBrushXml.js"></script>
<script type="text/javascript" src="./../static/syntaxhighlighter/shBrushPhp.js"></script>
<script type="text/javascript" src="./../static/syntaxhighlighter/shBrushLua.js"></script>
<script type="text/javascript" src="./../static/syntaxhighlighter/shBrushCpp.js"></script>
<script type="text/javascript" src="./../static/syntaxhighlighter/shBrushCss.js"></script>
<script type="text/javascript" src="./../static/syntaxhighlighter/shBrushCSharp.js"></script>
<link type="text/css" rel="stylesheet" href="./../static/syntaxhighlighter/css/shCoreDefault.css"/>
<script type="text/javascript">SyntaxHighlighter.all();</script>

<!-- for LaTeX equations 暫時不用
<script src="https://scrum-3.github.io/web/math/MathJax.js?config=TeX-MML-AM_CHTML" type="text/javascript"></script>
<script type="text/javascript">
init_mathjax = function() {
    if (window.MathJax) {
        // MathJax loaded
        MathJax.Hub.Config({
            tex2jax: {
                inlineMath: [ ['$','$'], ["\\(","\\)"] ],
                displayMath: [ ['$$','$$'], ["\\[","\\]"] ]
            },
            displayAlign: 'left', // Change this to 'center' to center equations.
            "HTML-CSS": {
                styles: {'.MathJax_Display': {"margin": 0}}
            }
        });
        MathJax.Hub.Queue(["Typeset",MathJax.Hub]);
    }
}
init_mathjax();
</script>
-->
<!-- 暫時不用
<script src="./../static/fengari-web.js"></script>
<script type="text/javascript" src="./../static/Cango-13v08-min.js"></script>
<script type="text/javascript" src="./../static/CangoAxes-4v01-min.js"></script>
<script type="text/javascript" src="./../static/gearUtils-05.js"></script>
-->
<!-- for Brython 暫時不用
<script src="https://scrum-3.github.io/web/brython/brython.js"></script>
<script src="https://scrum-3.github.io/web/brython/brython_stdlib.js"></script>
-->
<style>
img.with_border {
    border: 3px solid red;
}
</style>

<script type="text/javascript">
/*shorthand of $(document).ready(function(){};); */
$(function(){
    $("ul.topmenu> li:has(ul) > a").append('<div class="arrow-right"></div>');
    $("ul.topmenu > li ul li:has(ul) > a").append('<div class="arrow-right"></div>');
});
function doSearch() {
     $('#tipue_search_input').tipuesearch({
        newWindow: true, minimumLength: 2
     });
}
$(document).ready(doSearch);
</script>

</head><header><h1>2019 Spring 協同產品設計實習</h1> <confmenu>
<ul>
<li><a href="index.html">Home</a></li>
<li><a href="sitemap.html">Site Map</a></li>
<li><a href="./../reveal/index.html">reveal</a></li>
<li><a href="./../blog/index.html">blog</a></li>

</ul>
</confmenu></header>
<div class='container'><nav><ul id='css3menu1' class='topmenu'><div class="tipue_search_group"><input style="width: 6vw;" type="text" name="q" id="tipue_search_input" pattern=".{2,}" title="Press enter key to search" required></div><li><a href='Introduction.html'>Introduction</a><ul><li><a href='Future Jobs Report.html'>Future Jobs Report</a></li></ul><li><a href='實習任務.html'>實習任務</a><ul><li><a href='實習任務一.html'>實習任務一</a><ul><li><a href='建立可攜程式系統.html'>建立可攜程式系統</a><li><a href='第一週分組程式.html'>第一週分組程式</a><li><a href='Git Book 摘要.html'>Git Book 摘要</a><li><a href='Github 自學.html'>Github 自學</a><li><a href='w1取分項目.html'>w1取分項目</a></li></ul><li><a href='實習任務二.html'>實習任務二</a><ul><li><a href='V-rep Introduction.html'>V-rep Introduction</a><li><a href='BubbleRob.html'>BubbleRob</a><li><a href='BubbleRob1.html'>BubbleRob1</a></li></ul><li><a href='實習任務三.html'>實習任務三</a><li><a href='實習任務四.html'>實習任務四</a><li><a href='實習任務五.html'>實習任務五</a><li><a href='實習任務六.html'>實習任務六</a></li></ul><li><a href='協同設計.html'>協同設計</a><li><a href='Onshape.html'>Onshape</a><ul><li><a href='BOMs.html'>BOMs</a></li></ul><li><a href='FreeCAD.html'>FreeCAD</a><ul><li><a href='FreeCAD STL.html'>FreeCAD STL</a></li></ul><li><a href='V-rep.html'>V-rep</a><ul><li><a href='V-rep Tutorial.html'>V-rep Tutorial</a><li><a href='v-rep ref.html'>v-rep ref</a></li></ul><li><a href='Webots.html'>Webots</a><ul><li><a href='Webots doc.html'>Webots doc</a></li></ul></nav><section><div id="tipue_search_content">V-rep Introduction << <a href='V-rep Introduction.html'>Previous</a> <a href='BubbleRob1.html'>Next</a> >> BubbleRob1<br /><h1>BubbleRob</h1>
<h4>V-rep user manual:</h4>
<p><a href="http://www.coppeliarobotics.com/helpFiles/">http://www.coppeliarobotics.com/helpFiles/</a></p>
<h4>BubbleRob Tutorial:</h4>
<p><a href="http://www.coppeliarobotics.com/helpFiles/en/bubbleRobTutorial.htm">http://www.coppeliarobotics.com/helpFiles/en/bubbleRobTutorial.htm</a> </p>
<p>操作步驟參考: <a href="http://fid.cl/courses/ai-robotics/vrep-tut/tutorial_VREP_bob.pdf">http://fid.cl/courses/ai-robotics/vrep-tut/tutorial_VREP_bob.pdf</a>  (<a href="./../downloads/tutorial_VREP_bob.pdf">tutorial_VREP_bob.pdf</a>)</p>
<p><a href="./../downloads/introduction_to_robotics_mechanics_planning_and_control.pdf">introduction_to_robotics_mechanics_planning_and_control.pdf</a></p>
<p><a href="./../downloads/ModernRobotics.zip">modern_robotics.zip</a></p>
<p><a href="./../downloads/ModernRobotics_lib.7z">modern_robotics_lib.zip</a> (<a href="https://github.com/NxRLab/ModernRobotics">https://github.com/NxRLab/ModernRobotics</a> )</p>
<p><a href="./../downloads/IKexercise.pdf">Inverse Kinematics.pdf</a></p>
<p><a href="./../downloads/MR_practice_exercises.pdf">modern_robotics_exercise.pdf</a></p>
<p>V-rep Introduction: <a href="http://hades.mech.northwestern.edu/index.php/V-REP_Introduction">http://hades.mech.northwestern.edu/index.php/V-REP_Introduction</a> </p>
<p>Get started with V-rep: <a href="http://hades.mech.northwestern.edu/index.php/Getting_Started_with_the_V-REP_Simulator">http://hades.mech.northwestern.edu/index.php/Getting_Started_with_the_V-REP_Simulator</a> </p>
<h4>動態模擬考量</h4>
<p>If we run the simulation again, we can notice that both objects do not interfere<br/>anymore. However, we notice that BubbleRob slightly moves, even with locked motor.</p>
<p>We also try to run the simulation with different physics engines: the result will be<br/>different. Stability of dynamic simulations is tightly linked to masses and inertias of<br/>the involved non-static shapes.</p>
<p>This has to do with the objects masses: Keep masses similar and not too light.<br/>When linking two shapes with a dynamically enabled joint or a dynamically enabled<br/>force sensor, make sure the two shape’s masses are not too different (m1 &lt; 10 ∗ m2<br/>and m2 &lt; 10 ∗ m1), otherwise the joint or force sensor might be very soft and wobbly<br/>and present large positional/orientational errors (this effect can however also be used<br/>as a natural damping sometimes).</p>
<p>Additionally, very low mass shapes should be avoided since they won’t be able to<br/>exert very large forces onto other shapes (even if propelled by high force actuators!).<br/>Lastly, the intertia has a role to play: Keep principal moments of inertia* relatively<br/>large.</p>
<p>Try keeping the principal moments of inertia / mass (*refer to the shape dynamics<br/>properties dialog) relatively large, otherwise mechanical chains might be difficult to<br/>control and/or might behave in a strange way.</p>
<p>Therefore, we need to multiply all involved object’s masses by 8</p>
<h4>建立 Model</h4>
<p><span>We now need to finish </span><strong>BubbleRob</strong><span><span> </span>as a<span> </span></span><a href="http://www.coppeliarobotics.com/helpFiles/en/models.htm">model</a><span><span> </span>definition. We select the model base (i.e. object<span> </span></span><em>bubbleRob</em><span>) then check items<span> </span></span><strong>Object is model base</strong><span><span> </span>and<span> </span></span><strong>Object/model can transfer or accept DNA</strong><span><span> </span>in the<span> </span></span><a href="http://www.coppeliarobotics.com/helpFiles/en/commonPropertiesDialog.htm">object common properties</a><span>: there is now a stippled bounding box that encompasses all objects in the model hierarchy. </span></p>
<p><span>We select the two joints, the proximity sensor and the graph, then enable item<span> <strong>Ignored by model bounding box</strong></span></span><span><span> </span>and click<span> </span></span><strong>Apply to selection</strong><span>, in the same dialog: the model bounding box now ignores the two joints and the proximity sensor. Still in the same dialog, we disable<span> </span></span><strong>camera visibility layer</strong><span><span> </span>2, and enable<span> </span></span><strong>camera visibility layer</strong><span><span> </span>10 for the two joints and the force sensor: this effectively hides the two joints and the force sensor, since layers 9-16 are disabled by default. </span></p>
<p><span>At any time we can<span> </span></span><a href="http://www.coppeliarobotics.com/helpFiles/en/layerSelectionDialog.htm">modify the visibility layers for the whole scene</a><span>. To finish the model definition, we select the vision sensor, the two wheels, the slider, and the graph, then enable item<span> </span></span><strong>Select base of model instead</strong><span>: if we now try to select an object in our model in the scene, the whole model will be selected instead, which is a convenient way to handle and manipulate the whole model as a single object.</span></p>
<p><span> Additionally, this protects the model against inadvertant modification. Individual objects in the model can still be selected in the scene by click-selecting them with control-shift, or normally selecting them in the scene hierarchy. We finally collapse the model tree in the scene hierarchy. This is what we have:</span></p>
<h4><span>新增 Vision Sensor</span></h4>
<p><span>Next we will add a vision sensor, at the same position and orientation as BubbleRob's proximity sensor. We open the model hierarchy again, then click [Menu bar --&gt; Add --&gt; Vision sensor --&gt; Perspective type], then attach the vision sensor to the proximity sensor, and set the local position and orientation of the vision sensor to (0,0,0). </span></p>
<p><span>We also make sure the vision sensor is not not visible, not part of the model bounding box, and that if clicked, the model will be selected instead. In order to customize the vision sensor, we open its properties dialog. We set the Far clipping plane item to 1, and the Resolution x and Resolution y items to 256 and 256. </span></p>
<p><span>We then open the vision sensor filter dialog by clicking Show filter dialog. We select the filter component Edge detection on work image and click Add filter. We position the newly added filter in second position (one position up, using the up button). We double-click the newly added filter component and adjust its Threshold item to 0.2, then click OK. We add a floating view to the scene, and over the newly added floating view, right-click [Popup menu --&gt; View --&gt; Associate view with selected vision sensor] (we make sure the vision sensor is selected during that process). </span></p>
<p><span>To be able to see the vision sensor's image, we start the simulation, then stop it again.<br/>The last thing that we need for our scene is a small child script that will control BubbleRob's behavior. We select bubbleRob and click [Menu bar --&gt; Add --&gt; Associated child script --&gt; Non threaded]. This just added a non-threaded child script to the scene, and associated it with bubbleRob. </span></p>
<p><span>We can also add, remove or modify scripts via the script dialog which can be opened with [Menu bar --&gt; Tools --&gt; Scripts] or through the appropriate toolbar button:</span></p>
<h4><span>Lua 控制程式</span></h4>
<pre class="brush:lua;auto-links:false;toolbar:false" contenteditable="false">function speedChange_callback(ui,id,newVal)
    speed=minMaxSpeed[1]+(minMaxSpeed[2]-minMaxSpeed[1])*newVal/100
end

function sysCall_init()
    -- This is executed exactly once, the first time this script is executed
    bubbleRobBase=sim.getObjectAssociatedWithScript(sim.handle_self) -- this is bubbleRob's handle
    leftMotor=sim.getObjectHandle("bubbleRob_leftMotor") -- Handle of the left motor
    rightMotor=sim.getObjectHandle("bubbleRob_rightMotor") -- Handle of the right motor
    noseSensor=sim.getObjectHandle("bubbleRob_sensingNose") -- Handle of the proximity sensor
    minMaxSpeed={50*math.pi/180,300*math.pi/180} -- Min and max speeds for each motor
    backUntilTime=-1 -- Tells whether bubbleRob is in forward or backward mode
    -- Create the custom UI:
        xml = '&lt;ui title="'..sim.getObjectName(bubbleRobBase)..' speed" closeable="false" resizeable="false" activate="false"&gt;'..[[
        &lt;hslider minimum="0" maximum="100" onchange="speedChange_callback" id="1"/&gt;
        &lt;label text="" style="* {margin-left: 300px;}"/&gt;
        &lt;/ui&gt;
        ]]
    ui=simUI.create(xml)
    speed=(minMaxSpeed[1]+minMaxSpeed[2])*0.5
    simUI.setSliderValue(ui,1,100*(speed-minMaxSpeed[1])/(minMaxSpeed[2]-minMaxSpeed[1]))
end

function sysCall_actuation()
    result=sim.readProximitySensor(noseSensor) -- Read the proximity sensor
    -- If we detected something, we set the backward mode:
    if (result&gt;0) then backUntilTime=sim.getSimulationTime()+4 end 

    if (backUntilTime&lt;sim.getSimulationTime()) then
        -- When in forward mode, we simply move forward at the desired speed
        sim.setJointTargetVelocity(leftMotor,speed)
        sim.setJointTargetVelocity(rightMotor,speed)
    else
        -- When in backward mode, we simply backup in a curve at reduced speed
        sim.setJointTargetVelocity(leftMotor,-speed/2)
        sim.setJointTargetVelocity(rightMotor,-speed/8)
    end
end

function sysCall_cleanup()
	simUI.destroy(ui)
end</pre>
<h4>Building Clean Model</h4>
<p><a href="http://www.coppeliarobotics.com/helpFiles/en/buildingAModelTutorial.htm">http://www.coppeliarobotics.com/helpFiles/en/buildingAModelTutorial.htm</a> </p>
<h4>Designing Dynamic Simulation</h4>
<p><a href="http://www.coppeliarobotics.com/helpFiles/en/designingDynamicSimulations.htm#staticAndRespondable">http://www.coppeliarobotics.com/helpFiles/en/designingDynamicSimulations.htm#staticAndRespondable</a> </p>
<h4>ResizeableFloor</h4>
<p>網際 Lua 程式執行環境: <a href="http://mde.tw/vecp2018/lua/SchoolProject/">http://mde.tw/vecp2018/lua/SchoolProject/</a> </p>
<pre class="brush:lua;auto-links:false;toolbar:false" contenteditable="false">function sysCall_init()
    model=sim.getObjectAssociatedWithScript(sim.handle_self)
    e1=sim.getObjectHandle('ResizableFloor_5_25_element')
    e2=sim.getObjectHandle('ResizableFloor_5_25_visibleElement')
end

function sysCall_cleanup()
    hideDlg()
end

function sysCall_nonSimulation()
    local s=sim.getObjectSelection()
    if s and #s&gt;=1 and s[1]==model then
        showDlg()
    else
        hideDlg()
    end
end

function sysCall_beforeSimulation()
    hideDlg()
end

function sysCall_beforeSimulation()
    hideDlg()
end

function updateFloor()
    local c=readInfo()
    local sx=c['sizes'][1]/5
    local sy=c['sizes'][2]/5
    local sizeFact=sim.getObjectSizeFactor(model)
    sim.setObjectParent(e1,-1,true)
    local child=sim.getObjectChild(model,0)
    while child~=-1 do
        sim.removeObject(child)
        child=sim.getObjectChild(model,0)
    end
    local xPosInit=(sx-1)*-2.5*sizeFact
    local yPosInit=(sy-1)*-2.5*sizeFact
    local f1,f2
    for x=1,sx,1 do
        for y=1,sy,1 do
            if (x==1)and(y==1) then
                sim.setObjectParent(e1,model,true)
                f1=e1
            else
                f1=sim.copyPasteObjects({e1},0)[1]
                f2=sim.copyPasteObjects({e2},0)[1]
                sim.setObjectParent(f1,model,true)
                sim.setObjectParent(f2,f1,true)
            end
            local p=sim.getObjectPosition(f1,sim.handle_parent)
            p[1]=xPosInit+(x-1)*5*sizeFact
            p[2]=yPosInit+(y-1)*5*sizeFact
            sim.setObjectPosition(f1,sim.handle_parent,p)
        end
    end
end

function getDefaultInfoForNonExistingFields(info)
    if not info['version'] then
        info['version']=0
    end
    if not info['sizes'] then
        info['sizes']={1,1}
    end
end

function readInfo()
    local data=sim.readCustomDataBlock(model,'XYZ_FLOOR_INFO')
    if data then
        data=sim.unpackTable(data)
    else
        data={}
    end
    getDefaultInfoForNonExistingFields(data)
    return data
end

function writeInfo(data)
    if data then
        sim.writeCustomDataBlock(model,'XYZ_FLOOR_INFO',sim.packTable(data))
    else
        sim.writeCustomDataBlock(model,'XYZ_FLOOR_INFO','')
    end
end

function updateUi()
    local c=readInfo()
    local sizeFact=sim.getObjectSizeFactor(model)
    simUI.setLabelText(ui,1,'X-size (m): '..string.format("%.2f",c['sizes'][1]*sizeFact),true)
    simUI.setSliderValue(ui,2,c['sizes'][1]/5,true)
    simUI.setLabelText(ui,3,'Y-size (m): '..string.format("%.2f",c['sizes'][2]*sizeFact),true)
    simUI.setSliderValue(ui,4,c['sizes'][2]/5,true)
end

function sliderXChange(ui,id,newVal)
    local c=readInfo()
    c['sizes'][1]=newVal*5
    writeInfo(c)
    updateUi()
    updateFloor()
end

function sliderYChange(ui,id,newVal)
    local c=readInfo()
    c['sizes'][2]=newVal*5
    writeInfo(c)
    updateUi()
    updateFloor()
end

function closeEventHandler(h)
    sim.removeScript(sim.handle_self)
end

function showDlg()
    if not ui then
    xml = [[
&lt;ui title="Floor Customizer" closeable="true" on-close="closeEventHandler" resizable="false" activate="false"&gt;
    &lt;group layout="form" flat="true"&gt;
        &lt;label text="X-size (m): 1" id="1"/&gt;
        &lt;hslider tick-position="above" tick-interval="1" minimum="1" maximum="5" on-change="sliderXChange" id="2"/&gt;
        &lt;label text="Y-size (m): 1" id="3"/&gt;
        &lt;hslider tick-position="above" tick-interval="1" minimum="1" maximum="5" on-change="sliderYChange" id="4"/&gt;
    &lt;/group&gt;
    &lt;label text="" style="* {margin-left: 400px;}"/&gt;
&lt;/ui&gt;
]]
        ui=simUI.create(xml)
        if 2==sim.getInt32Parameter(sim.intparam_platform) then
            -- To fix a Qt bug on Linux
            sim.auxFunc('activateMainWindow')
        end
        updateUi()
    end
end

function hideDlg()
    if ui then
        simUI.destroy(ui)
        ui=nil
    end
end
</pre>
<p>左右輪分別建立 slider:</p>
<pre class="brush:lua;auto-links:false;toolbar:false" contenteditable="false">function sysCall_init()
         
    -- This is executed exactly once, the first time this script is executed
    bubbleRobBase=sim.getObjectAssociatedWithScript(sim.handle_self) -- this is bubbleRob's handle
    leftMotor=sim.getObjectHandle("bubbleRob_leftMotor") -- Handle of the left motor
    rightMotor=sim.getObjectHandle("bubbleRob_rightMotor") -- Handle of the right motor
    noseSensor=sim.getObjectHandle("bubbleRob_sensingNose") -- Handle of the proximity sensor
    minMaxSpeed={50*math.pi/180,300*math.pi/180} -- Min and max speeds for each motor
    backUntilTime=-1 -- Tells whether bubbleRob is in forward or backward mode
    -- Create the custom UI:
    xml = '&lt;ui title="'..sim.getObjectName(bubbleRobBase)..' speed" closeable="false" resizeable="false" activate="false"&gt;'..[[
                &lt;label text="left motor speed" wordwrap="false" /&gt;
                &lt;hslider minimum="0" maximum="100" on-change="left_speedChange_callback" id="1"/&gt;
                &lt;label text="right motor speed" wordwrap="false" /&gt;
                &lt;hslider minimum="0" maximum="100" on-change="right_speedChange_callback" id="2"/&gt;
            &lt;label text="" style="* {margin-left: 300px;}"/&gt;
        &lt;/ui&gt;
        ]]
    ui=simUI.create(xml)
    left_speed=(minMaxSpeed[1]+minMaxSpeed[2])*0.5
    right_speed=(minMaxSpeed[1]+minMaxSpeed[2])*0.5
    simUI.setSliderValue(ui,1,100*(left_speed-minMaxSpeed[1])/(minMaxSpeed[2]-minMaxSpeed[1]))
    simUI.setSliderValue(ui,2,100*(left_speed-minMaxSpeed[1])/(minMaxSpeed[2]-minMaxSpeed[1]))
    
end
function right_speedChange_callback(ui,id,newVal)
    right_speed=minMaxSpeed[1]+(minMaxSpeed[2]-minMaxSpeed[1])*newVal/100
end

function left_speedChange_callback(ui,id,newVal)
    left_speed=minMaxSpeed[1]+(minMaxSpeed[2]-minMaxSpeed[1])*newVal/100
end


function sysCall_actuation() 
    result=sim.readProximitySensor(noseSensor) -- Read the proximity sensor
    -- If we detected something, we set the backward mode:
    if (result&gt;0) then backUntilTime=sim.getSimulationTime()+4 end 

    if (backUntilTime&lt;sim.getSimulationTime()) then
        -- When in forward mode, we simply move forward at the desired speed
        sim.setJointTargetVelocity(leftMotor,left_speed)
        sim.setJointTargetVelocity(rightMotor,right_speed)
    else
        -- When in backward mode, we simply backup in a curve at reduced speed
        sim.setJointTargetVelocity(leftMotor,-left_speed/2)
        sim.setJointTargetVelocity(rightMotor,-right_speed/8)
    end
end

function sysCall_cleanup() 
    simUI.destroy(ui)
end 
</pre>
<p></p>
<br />V-rep Introduction << <a href='V-rep Introduction.html'>Previous</a> <a href='BubbleRob1.html'>Next</a> >> BubbleRob1</div></section></div></body></html>